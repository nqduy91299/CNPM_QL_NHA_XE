CREATE DATABASE QUAN_LY_NHA_XE
USE QUAN_LY_NHA_XE

--LUONG NV--------#######################################
CREATE TABLE LUONG_COBAN(
CHUC_VU NVARCHAR(50),
TIEN_LUONG INT NOT NULL,
PRIMARY KEY (CHUC_VU)
)


--NHAN VIEN-------------###################################
CREATE TABLE NHAN_VIEN(
MA_NV VARCHAR(6),
TEN_NV NVARCHAR(100) NOT NULL,
NGAY_SINH DATE NOT NULL,
GIOI_TINH NVARCHAR(10) CHECK(GIOI_TINH = N'Nam' or  GIOI_TINH = N'Nữ') NOT NULL,
CMND CHAR(9) NOT NULL UNIQUE,
DIA_CHI NVARCHAR(100) NOT NULL,
SDT CHAR(10) NOT NULL,
NGAY_VAO_LAM DATE NOT NULL,
CHUC_VU NVARCHAR(50) NOT NULL,
PRIMARY KEY(MA_NV),
FOREIGN KEY(CHUC_VU) REFERENCES LUONG_COBAN(CHUC_VU)
)


--TAI_KHOAN------------#################################
CREATE TABLE TAI_KHOAN(
MA_NV VARCHAR(6),
TAI_KHOAN VARCHAR(50) PRIMARY KEY,
MAT_KHAU VARCHAR(50) not null,
TYPE BIT not null, --0-1
FOREIGN KEY(MA_NV) REFERENCES NHAN_VIEN(MA_NV)
)



-- TUYEN XE _---------##################################

CREATE TABLE TUYEN_XE(
ID INT IDENTITY(1,1) PRIMARY KEY,
NAME NVARCHAR(100)
)




--GIO CHAY------------###################################
CREATE TABLE GIO_CHAY(
ID INT IDENTITY(1,1) PRIMARY KEY,
GIO VARCHAR(5),
ID_TUYEN_XE int,
FOREIGN KEY(ID_TUYEN_XE) REFERENCES TUYEN_XE(ID)
)




--XEEEEEEEEEE______--########################################

CREATE TABLE XE(
ID INT IDENTITY(1,1) PRIMARY KEY,
SO_GHE INT NOT NULL,
TEN_XE NVARCHAR(50),
BIEN_SO VARCHAR(9) NOT NULL UNIQUE,
ID_GIOKH INT,
FOREIGN KEY(ID_GIOKH) REFERENCES GIO_CHAY(ID)
)



--LICH_TRINH-----##################################################3
CREATE TABLE LICH_TRINH(
ID INT IDENTITY(1,1),
ID_XE INT,
GIA_VE INT,
MA_NV VARCHAR(6)
PRIMARY KEY(ID),
FOREIGN KEY(ID_XE) REFERENCES XE(ID),
FOREIGN KEY(MA_NV) REFERENCES NHAN_VIEN(MA_NV)
)



--THONG_TIN_VE_BAN-----------###########################################

CREATE TABLE TT_VE(
ID INT IDENTITY PRIMARY KEY,
TEN_KH NVARCHAR(100),
SDT_KH VARCHAR(10),
SO_TT_GHE INT,
CHUYEN NVARCHAR(100),
GIO VARCHAR(10),
BIEN_SO VARCHAR(10),
ID_XE INT,
NGAY_BAN DATE,
FOREIGN KEY(ID_XE) REFERENCES XE(ID)
)




-----PROC TABLE LUONG ------###########################
CREATE PROC SEARCH_LUONG_CHUCVU
@CHUCVU NVARCHAR(50)
AS
BEGIN
	SELECT b.MA_NV, b.TEN_NV, b.GIOI_TINH, a.CHUC_VU, a.TIEN_LUONG FROM LUONG_NV a, NHAN_VIEN b WHERE a.CHUC_VU =b.CHUC_VU AND a.CHUC_VU = @CHUCVU 
END 


-------------------------------------------
CREATE PROC SEARCH_LUONG_TENNV
@TEN_NV NVARCHAR(100)
AS
BEGIN
	SELECT b.MA_NV, b.TEN_NV, b.GIOI_TINH, a.CHUC_VU, a.TIEN_LUONG FROM LUONG_NV a, NHAN_VIEN b WHERE a.CHUC_VU =b.CHUC_VU AND b.TEN_NV =@TEN_NV
END 




---PROC TABLE NHAN VIEN----------###############################################
CREATE PROC SEARCH_NV_TEN
@TEN_NV NVARCHAR(100)
AS
BEGIN
	SELECT * FROM NHAN_VIEN WHERE TEN_NV = @TEN_NV 
END 



--------------------------------------------------------------------------------

CREATE PROC SEARCH_NV_SDT
@SDT CHAR(10)
AS
BEGIN
	SELECT * FROM NHAN_VIEN WHERE SDT = @SDT
END 
---------------------------------------------------------------------------------


CREATE PROC SEARCH_NV_MANV
@MA_NV VARCHAR(6)
AS
BEGIN
	SELECT * FROM NHAN_VIEN WHERE MA_NV = @MA_NV 
END 





--PROC TABLE TAI KHOAN-----------#############################################
CREATE PROC LOGIN_MAIN(
@TAIKHOAN NVARCHAR(10),
@MATKHAU NVARCHAR(10)
)
AS
BEGIN
	SELECT * FROM TAI_KHOAN WHERE TAI_KHOAN = @TAIKHOAN AND MAT_KHAU = @MATKHAU 
END 



--PROC TABLE XE----------###################################################
CREATE PROC SEARCH_XE_MAXE
@ID INT
AS
BEGIN
	SELECT * FROM XE WHERE ID = @ID 
END 

----------------------------------------------------
CREATE PROC SEARCH_XE_BIENSO
@BIEN_SO VARCHAR(9)
AS
BEGIN
	SELECT * FROM XE WHERE BIEN_SO = @BIEN_SO 
END 



--PROC TABLE TT_VE -----------#################################
CREATE PROC SEARCH_SDT_KH
@SDT CHAR(10)
AS
BEGIN
	SELECT * FROM TT_VE WHERE SDT_KH = @SDT
END 




-------INSERT---------------------------------###############################


INSERT INTO LUONG_COBAN VALUES(N'NV Bán Vé', 8000000)
INSERT INTO LUONG_COBAN VALUES(N'Quản Lý', 13000000)
INSERT INTO LUONG_COBAN VALUES(N'Tài Xế', 10000000)


INSERT INTO NHAN_VIEN VALUES('NV1', N'Nguyễn Thị C', '12/11/1998', N'Nữ', '121451233', N'TP CẦN THƠ', '0928362222', '2/12/2018', N'Quản Lý')
INSERT INTO NHAN_VIEN VALUES('NV2', N'Nguyễn Quốc A', '12/9/1999', N'Nam', '123456789', N'TP HỒ CHÍ MINH', '0888888888', '2/11/2018', N'NV Bán Vé')
INSERT INTO NHAN_VIEN VALUES('NV3', N'Nguyễn Văn B', '1/7/1999', N'Nam', '223456782', N'TP HỒ CHÍ MINH', '0888342588', '2/11/2018', N'Tài Xế')
INSERT INTO NHAN_VIEN VALUES('NV4', N'Nguyễn Thị X', '12/12/2000', N'Nữ', '121452389', N'TP CẦN THƠ', '0928364512', '2/20/2018', N'NV Bán Vé')
INSERT INTO NHAN_VIEN VALUES('NV5', N'Nguyễn Văn D', '1/7/1999', N'Nam', '223412382', N'TP HỒ CHÍ MINH', '0123442588', '2/11/2018', N'Tài Xế')
INSERT INTO NHAN_VIEN VALUES('NV6', N'Nguyễn Văn E', '1/7/1999', N'Nam', '221236782', N'TP HỒ CHÍ MINH', '0812342588', '2/11/2018', N'Tài Xế')
INSERT INTO NHAN_VIEN VALUES('NV7', N'Nguyễn Văn FE', '1/21/1999', N'Nam', '221212782', N'TP HỒ CHÍ MINH', '0123342588', '2/11/2018', N'Tài Xế')


INSERT INTO TAI_KHOAN VALUES('NV1', 'quoca12', '123456', '0')
INSERT INTO TAI_KHOAN VALUES('NV2', 'vanb', '987654', '1')
INSERT INTO TAI_KHOAN VALUES('NV3', 'thix','234561', '1')


INSERT INTO TUYEN_XE VALUES(N'CÀ MAU - SÀI GÒN')
INSERT INTO TUYEN_XE VALUES(N'CÀ MAU - CẦN THƠ')


INSERT INTO GIO_CHAY VALUES('09:00', 1)
INSERT INTO GIO_CHAY VALUES('12:00', 1)
INSERT INTO GIO_CHAY VALUES('09:00', 2)
INSERT INTO GIO_CHAY VALUES('12:30', 2)
INSERT INTO GIO_CHAY VALUES('12:15', 2)

INSERT INTO XE VALUES(40, 'HONDA', '51G-12541' , 1)
INSERT INTO XE VALUES(25, 'HONDA', '51G-12321', 2)
INSERT INTO XE VALUES(40, 'HUYNHDAI', '51G-11231', 3)
INSERT INTO XE VALUES(40, 'HONDA', '51G-12542', 4)


INSERT INTO LICH_TRINH VALUES(1, 150000, 'NV3')
INSERT INTO LICH_TRINH VALUES(2, 110000, 'NV5')
INSERT INTO LICH_TRINH VALUES(3, 150000, 'NV6')
INSERT INTO LICH_TRINH VALUES(4, 110000, 'NV7')
INSERT INTO LICH_TRINH VALUES(4, 110000, 'NV7')





INSERT INTO TT_VE VALUES (N'Duy', '0232452145', 1, N'CÀ MAU - SÀI GÒN', '09:00', '51G-12541', 1, GETDATE())
INSERT INTO TT_VE VALUES (N'Duy', '0123412145', 2, N'CÀ MAU - SÀI GÒN', '09:00', '51G-12541', 1, GETDATE())


